<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paparazzi UAS: sw/airborne/modules/loggers/sdlog_chibios/sdLog.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paparazzi UAS
   &#160;<span id="projectnumber">v6.2_unstable</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sdLog_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sdLog.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;ch.h&gt;</code><br />
<code>#include &lt;hal.h&gt;</code><br />
<code>#include &lt;ff.h&gt;</code><br />
<code>#include &quot;<a class="el" href="sdLog_8h_source.html">modules/loggers/sdlog_chibios/sdLog.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="printf_8h_source.html">printf.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sdio_8h_source.html">mcu_periph/sdio.h</a>&quot;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for sdLog.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c__incl.png" border="0" usemap="#sw_2airborne_2modules_2loggers_2sdlog__chibios_2sdLog_8c" alt=""/></div>
<map name="sw_2airborne_2modules_2loggers_2sdlog__chibios_2sdLog_8c" id="sw_2airborne_2modules_2loggers_2sdlog__chibios_2sdLog_8c">
<area shape="rect" title=" " alt="" coords="248,5,415,61"/>
<area shape="rect" title=" " alt="" coords="5,117,76,143"/>
<area shape="rect" title=" " alt="" coords="100,117,171,143"/>
<area shape="rect" title=" " alt="" coords="181,199,231,225"/>
<area shape="rect" title=" " alt="" coords="255,199,309,225"/>
<area shape="rect" title=" " alt="" coords="583,117,626,143"/>
<area shape="rect" href="sdLog_8h.html" title=" " alt="" coords="389,109,559,151"/>
<area shape="rect" href="printf_8h.html" title="Mini printf&#45;like functionality." alt="" coords="297,117,365,143"/>
<area shape="rect" href="sdio_8h.html" title="arch independent SDIO API" alt="" coords="650,117,791,143"/>
<area shape="rect" title=" " alt="" coords="816,117,887,143"/>
<area shape="rect" title=" " alt="" coords="547,199,601,225"/>
<area shape="rect" title=" " alt="" coords="433,199,523,225"/>
<area shape="rect" title=" " alt="" coords="334,199,409,225"/>
</map>
</div>
</div>
<p><a href="sdLog_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a217a0bd562b98ae8c2ffce44935351e1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>(x)&#160;&#160;&#160;__builtin_expect(!!(x), 1)</td></tr>
<tr class="separator:a217a0bd562b98ae8c2ffce44935351e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6c45889010c1bd68631771b64f18101"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(x)&#160;&#160;&#160;__builtin_expect(!!(x), 0)</td></tr>
<tr class="separator:ac6c45889010c1bd68631771b64f18101"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e75242132eaabbc1c512488a135926"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a>(x,  y)&#160;&#160;&#160;(((x) &lt; (y)) ? (x) : (y))</td></tr>
<tr class="separator:a74e75242132eaabbc1c512488a135926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(x,  y)&#160;&#160;&#160;(((x) &gt; (y)) ? (x) : (y))</td></tr>
<tr class="separator:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4922593f9f95a4fabc34eacf23ac4550"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a4922593f9f95a4fabc34eacf23ac4550">IS_POWER_OF_TWO</a>(<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>)&#160;&#160;&#160;((<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>) &amp;&amp; !((<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>) &amp; ((<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>) - 1)))</td></tr>
<tr class="separator:a4922593f9f95a4fabc34eacf23ac4550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a275a34cd0d8f3b9b04ee91df269136e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a275a34cd0d8f3b9b04ee91df269136e3">FFCONF_DEF</a>&#160;&#160;&#160;_FATFS</td></tr>
<tr class="separator:a275a34cd0d8f3b9b04ee91df269136e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1cf68ce7e74ae0b79f57bbc3f7d2b77"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#af1cf68ce7e74ae0b79f57bbc3f7d2b77">SDLOG_WRITE_BUFFER_SIZE</a>&#160;&#160;&#160;(<a class="el" href="tawaki_2chibios_2common_2mcuconf_8h.html#abf3ea4f6b58f67f72d53c6f7e35d76f0">SDLOG_ALL_BUFFERS_SIZE</a>/<a class="el" href="tawaki_2chibios_2common_2mcuconf_8h.html#abfa7a6086a22ce269b39b1a7cd3ca4a1">SDLOG_NUM_FILES</a>)</td></tr>
<tr class="separator:af1cf68ce7e74ae0b79f57bbc3f7d2b77"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae82bd97eb545159246a84ebf2233421f"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#ae82bd97eb545159246a84ebf2233421f">IN_DMA_SECTION</a> (FATFS fatfs)</td></tr>
<tr class="separator:ae82bd97eb545159246a84ebf2233421f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fbab9a978291b87726867c0dcb05b81"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="vl53l1__types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a4fbab9a978291b87726867c0dcb05b81">uiGetIndexOfLogFile</a> (const char *prefix, const char *fileName)</td></tr>
<tr class="separator:a4fbab9a978291b87726867c0dcb05b81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870830d3ea4fe67badf79e52582f4fae"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a870830d3ea4fe67badf79e52582f4fae">flushWriteByteBuffer</a> (const <a class="el" href="sdLog_8h.html#a5af0a3873249752407b6c26c77c9a46d">FileDes</a> <a class="el" href="bat__voltage__ardrone2_8c.html#a6f8059414f0228f0256115e024eeed4b">fd</a>)</td></tr>
<tr class="separator:a870830d3ea4fe67badf79e52582f4fae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a598888320386c21f975d32d68f29bcf3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a598888320386c21f975d32d68f29bcf3">sdLogInit</a> (<a class="el" href="vl53l1__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *freeSpaceInKo)</td></tr>
<tr class="memdesc:a598888320386c21f975d32d68f29bcf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialise sdLog  <a href="sdLog_8c.html#a598888320386c21f975d32d68f29bcf3">More...</a><br /></td></tr>
<tr class="separator:a598888320386c21f975d32d68f29bcf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03326adcb90b1cc07d684a6abaff2051"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a03326adcb90b1cc07d684a6abaff2051">sdLogFinish</a> (void)</td></tr>
<tr class="memdesc:a03326adcb90b1cc07d684a6abaff2051"><td class="mdescLeft">&#160;</td><td class="mdescRight">unmount filesystem  <a href="sdLog_8c.html#a03326adcb90b1cc07d684a6abaff2051">More...</a><br /></td></tr>
<tr class="separator:a03326adcb90b1cc07d684a6abaff2051"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a510de29d16898e7e402fe7ea2dc7b992"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a510de29d16898e7e402fe7ea2dc7b992">getFileName</a> (const char *prefix, const char *directoryName, char *nextFileName, const size_t nameLength, const int indexOffset)</td></tr>
<tr class="memdesc:a510de29d16898e7e402fe7ea2dc7b992"><td class="mdescLeft">&#160;</td><td class="mdescRight">get last used name for a pattern, then add offset and return valid filename  <a href="sdLog_8c.html#a510de29d16898e7e402fe7ea2dc7b992">More...</a><br /></td></tr>
<tr class="separator:a510de29d16898e7e402fe7ea2dc7b992"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0feebb43817c3a4d97e34f991012932c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a0feebb43817c3a4d97e34f991012932c">removeEmptyLogs</a> (const char *directoryName, const char *prefix, const size_t sizeConsideredEmpty)</td></tr>
<tr class="memdesc:a0feebb43817c3a4d97e34f991012932c"><td class="mdescLeft">&#160;</td><td class="mdescRight">remove spurious log file left on sd  <a href="sdLog_8c.html#a0feebb43817c3a4d97e34f991012932c">More...</a><br /></td></tr>
<tr class="separator:a0feebb43817c3a4d97e34f991012932c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a275a34cd0d8f3b9b04ee91df269136e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a275a34cd0d8f3b9b04ee91df269136e3">&#9670;&nbsp;</a></span>FFCONF_DEF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FFCONF_DEF&#160;&#160;&#160;_FATFS</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00055">55</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a id="a4922593f9f95a4fabc34eacf23ac4550"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4922593f9f95a4fabc34eacf23ac4550">&#9670;&nbsp;</a></span>IS_POWER_OF_TWO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_POWER_OF_TWO</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a></td><td>)</td>
          <td>&#160;&#160;&#160;((<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>) &amp;&amp; !((<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>) &amp; ((<a class="el" href="light__scheduler_8c.html#a2dee666f0c1fe072c549ff86b1d0a8ab">s</a>) - 1)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00047">47</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a id="a217a0bd562b98ae8c2ffce44935351e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a217a0bd562b98ae8c2ffce44935351e1">&#9670;&nbsp;</a></span>likely</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define likely</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;__builtin_expect(!!(x), 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00038">38</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a id="aacc3ee1a7f283f8ef65cea31f4436a95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacc3ee1a7f283f8ef65cea31f4436a95">&#9670;&nbsp;</a></span>MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">y&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((x) &gt; (y)) ? (x) : (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00045">45</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a id="a74e75242132eaabbc1c512488a135926"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74e75242132eaabbc1c512488a135926">&#9670;&nbsp;</a></span>MIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">y&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((x) &lt; (y)) ? (x) : (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00042">42</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a id="af1cf68ce7e74ae0b79f57bbc3f7d2b77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1cf68ce7e74ae0b79f57bbc3f7d2b77">&#9670;&nbsp;</a></span>SDLOG_WRITE_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SDLOG_WRITE_BUFFER_SIZE&#160;&#160;&#160;(<a class="el" href="tawaki_2chibios_2common_2mcuconf_8h.html#abf3ea4f6b58f67f72d53c6f7e35d76f0">SDLOG_ALL_BUFFERS_SIZE</a>/<a class="el" href="tawaki_2chibios_2common_2mcuconf_8h.html#abfa7a6086a22ce269b39b1a7cd3ca4a1">SDLOG_NUM_FILES</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00074">74</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a id="ac6c45889010c1bd68631771b64f18101"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6c45889010c1bd68631771b64f18101">&#9670;&nbsp;</a></span>unlikely</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define unlikely</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;__builtin_expect(!!(x), 0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00039">39</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a870830d3ea4fe67badf79e52582f4fae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a870830d3ea4fe67badf79e52582f4fae">&#9670;&nbsp;</a></span>flushWriteByteBuffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> flushWriteByteBuffer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="sdLog_8h.html#a5af0a3873249752407b6c26c77c9a46d">FileDes</a>&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a510de29d16898e7e402fe7ea2dc7b992"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a510de29d16898e7e402fe7ea2dc7b992">&#9670;&nbsp;</a></span>getFileName()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> getFileName </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>directoryName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nextFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>nameLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>indexOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get last used name for a pattern, then add offset and return valid filename </p>
<p>for log file, you often have a pattern and a version. To retreive last file for reading, call function with indexOffset=0. To get next available file for writing, call function with indexOffset=1 This function is available even without thread login facility : even if SDLOG_XXX macro are zeroed </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">prefix</td><td>: the pattern for the file : example LOG_ </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">directoryName</td><td>: root directory where to find file </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nextFileName</td><td>: file with path ready to be used for f_open system call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nameLength</td><td>: length of previous buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">indexOffset</td><td>: use 0 to retrieve last existent filename, 1 for next filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00722">722</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p class="reference">References <a class="el" href="printf_8c_source.html#l00377">chsnprintf()</a>, <a class="el" href="shift__tracking_8c_source.html#l00091">dir</a>, <a class="el" href="sdLog_8c_source.html#l00045">MAX</a>, <a class="el" href="sdLog_8c_source.html#l00042">MIN</a>, <a class="el" href="sdLog_8h_source.html#l00036">NUMBERFMF</a>, <a class="el" href="sdLog_8h_source.html#l00035">NUMBERMAX</a>, <a class="el" href="sdLog_8h_source.html#l00114">SDLOG_FATFS_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00123">SDLOG_LOGNUM_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00112">SDLOG_OK</a>, and <a class="el" href="sdLog_8c_source.html#l00843">uiGetIndexOfLogFile()</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph.png" border="0" usemap="#sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph" alt=""/></div>
<map name="sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph" id="sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph">
<area shape="rect" title="get last used name for a pattern, then add offset and return valid filename" alt="" coords="5,38,111,65"/>
<area shape="rect" href="group__chprintf.html#gabe5c0e0148763ecfd7829f6129f29e0a" title=" " alt="" coords="193,13,279,39"/>
<area shape="rect" href="sdLog_8c.html#a4fbab9a978291b87726867c0dcb05b81" title=" " alt="" coords="159,63,313,90"/>
<area shape="rect" href="group__chprintf.html#gaa4e64308af46238224f455c00a4fcf26" title="System formatted output function." alt="" coords="361,13,464,39"/>
<area shape="rect" href="group__chprintf.html#gac5d948ddbb98eeaf4c395f12d1673e2e" title=" " alt="" coords="512,13,559,39"/>
<area shape="rect" href="group__chprintf.html#ga083a2bdcd3b67b7be94900e8affc57b8" title=" " alt="" coords="607,5,756,47"/>
</map>
</div>

</div>
</div>
<a id="ae82bd97eb545159246a84ebf2233421f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae82bd97eb545159246a84ebf2233421f">&#9670;&nbsp;</a></span>IN_DMA_SECTION()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IN_DMA_SECTION </td>
          <td>(</td>
          <td class="paramtype">FATFS&#160;</td>
          <td class="paramname"><em>fatfs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a0feebb43817c3a4d97e34f991012932c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0feebb43817c3a4d97e34f991012932c">&#9670;&nbsp;</a></span>removeEmptyLogs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> removeEmptyLogs </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>directoryName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>sizeConsideredEmpty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>remove spurious log file left on sd </p>
<p>when tuning firmware, log files are created at each tries, and we consider that empty or nearly empty log are of no value this function remove log file whose size is less than a given value</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">prefix</td><td>: the pattern for the file : example LOG_ </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">directoryName</td><td>: root directory where to find file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sizeConsideredEmpty</td><td>: file whose size is less or equal to that value will be removed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00783">783</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p class="reference">References <a class="el" href="shift__tracking_8c_source.html#l00091">dir</a>, <a class="el" href="sdLog_8h_source.html#l00114">SDLOG_FATFS_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00115">SDLOG_FATFS_NOENT</a>, and <a class="el" href="sdLog_8h_source.html#l00112">SDLOG_OK</a>.</p>

<p class="reference">Referenced by <a class="el" href="sdlog__chibios_8c_source.html#l00225">thd_startlog()</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph.png" border="0" usemap="#sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph" alt=""/></div>
<map name="sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph" id="sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph">
<area shape="rect" title="remove spurious log file left on sd" alt="" coords="340,5,484,32"/>
<area shape="rect" href="sdlog__chibios_8c.html#a7cf4c749454b496e749b47e614750109" title=" " alt="" coords="192,5,292,32"/>
<area shape="rect" href="sdlog__chibios_8h.html#aeeba7682db35a9becddc07935f5d256a" title=" " alt="" coords="5,5,144,32"/>
</map>
</div>

</div>
</div>
<a id="a03326adcb90b1cc07d684a6abaff2051"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03326adcb90b1cc07d684a6abaff2051">&#9670;&nbsp;</a></span>sdLogFinish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> sdLogFinish </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>unmount filesystem </p>
<p>unmount filesystem, free sdio peripheral This function is available even without thread login facility : even if SDLOG_XXX macro are zeroed </p><dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00254">254</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p class="reference">References <a class="el" href="sdLog_8h_source.html#l00114">SDLOG_FATFS_ERROR</a>, and <a class="el" href="sdLog_8h_source.html#l00112">SDLOG_OK</a>.</p>

<p class="reference">Referenced by <a class="el" href="sdlog__chibios_8c_source.html#l00196">sdlog_chibios_finish()</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph.png" border="0" usemap="#sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph" alt=""/></div>
<map name="sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph" id="sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph">
<area shape="rect" title="unmount filesystem" alt="" coords="781,31,880,57"/>
<area shape="rect" href="sdlog__chibios_8h.html#a468073a8575335ab6b2d8291548e78ff" title=" " alt="" coords="581,31,733,57"/>
<area shape="rect" href="sdlog__chibios_8c.html#aee744de53d121395ef522cef118be731" title=" " alt="" coords="411,5,533,32"/>
<area shape="rect" href="usbStorage_8c.html#a03e36a472f457f472fc7031d798eac45" title=" " alt="" coords="413,56,531,83"/>
<area shape="rect" href="sdlog__chibios_8c.html#a7cf4c749454b496e749b47e614750109" title=" " alt="" coords="227,5,327,32"/>
<area shape="rect" href="sdlog__chibios_8h.html#aeeba7682db35a9becddc07935f5d256a" title=" " alt="" coords="5,31,144,57"/>
<area shape="rect" href="usbStorage_8h.html#a12081a3972cd8a738a527d104c647665" title=" " alt="" coords="192,56,363,83"/>
</map>
</div>

</div>
</div>
<a id="a598888320386c21f975d32d68f29bcf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a598888320386c21f975d32d68f29bcf3">&#9670;&nbsp;</a></span>sdLogInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> sdLogInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vl53l1__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *&#160;</td>
          <td class="paramname"><em>freeSpaceInKo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialise sdLog </p>
<p>init sdio peripheral, verify sdCard is inserted, check and mount filesystem, launch worker thread This function is available even without thread login facility : even if SDLOG_XXX macro are zeroed </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">freeSpaceInKo</td><td>: if pointer in nonnull, return free space on filesystem </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00194">194</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p class="reference">References <a class="el" href="std_8h_source.html#l00005">FALSE</a>, <a class="el" href="tlsf__malloc__arch_8h_source.html#l00044">HEAP_DEFAULT</a>, <a class="el" href="msg__queue_8c_source.html#l00042">msgqueue_init()</a>, <a class="el" href="sdio__arch_8c_source.html#l00048">sdio_connect()</a>, <a class="el" href="sdio__arch_8c_source.html#l00087">sdio_disconnect()</a>, <a class="el" href="sdLog_8h_source.html#l00114">SDLOG_FATFS_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00113">SDLOG_NOCARD</a>, <a class="el" href="apogee_2chibios_2v1_80_2mcuconf_8h_source.html#l00435">SDLOG_NUM_FILES</a>, <a class="el" href="sdLog_8h_source.html#l00112">SDLOG_OK</a>, <a class="el" href="apogee_2chibios_2v1_80_2mcuconf_8h_source.html#l00433">SDLOG_QUEUE_BUCKETS</a>, and <a class="el" href="sdLog_8h_source.html#l00124">SDLOG_WAS_LAUNCHED</a>.</p>

<p class="reference">Referenced by <a class="el" href="sdlog__chibios_8c_source.html#l00225">thd_startlog()</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph.png" border="0" usemap="#sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph" alt=""/></div>
<map name="sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph" id="sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph">
<area shape="rect" title="initialise sdLog" alt="" coords="5,56,87,83"/>
<area shape="rect" href="msg__queue_8c.html#a8cbe13f6801caa6bd92498e5772eb3df" title="initialise MsgQueue" alt="" coords="139,5,257,32"/>
<area shape="rect" href="sdio__arch_8c.html#a55d0f878fb169bbdd445d86648ee562b" title="Connect a SD card on SDIO peripheral." alt="" coords="145,56,251,83"/>
<area shape="rect" href="sdio__arch_8c.html#a1aaca4bd6a01a576869aa133f5fe0877" title="Disconnect a SD card on SDIO peripheral." alt="" coords="135,107,261,133"/>
</map>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph.png" border="0" usemap="#sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph" alt=""/></div>
<map name="sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph" id="sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph">
<area shape="rect" title="initialise sdLog" alt="" coords="340,5,421,32"/>
<area shape="rect" href="sdlog__chibios_8c.html#a7cf4c749454b496e749b47e614750109" title=" " alt="" coords="192,5,292,32"/>
<area shape="rect" href="sdlog__chibios_8h.html#aeeba7682db35a9becddc07935f5d256a" title=" " alt="" coords="5,5,144,32"/>
</map>
</div>

</div>
</div>
<a id="a4fbab9a978291b87726867c0dcb05b81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fbab9a978291b87726867c0dcb05b81">&#9670;&nbsp;</a></span>uiGetIndexOfLogFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vl53l1__types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> uiGetIndexOfLogFile </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fileName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sdLog_8c_source.html#l00843">843</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="sdLog_8c_source.html#l00722">getFileName()</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph.png" border="0" usemap="#sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph" alt=""/></div>
<map name="sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph" id="sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph">
<area shape="rect" title=" " alt="" coords="159,5,313,32"/>
<area shape="rect" href="sdLog_8h.html#a510de29d16898e7e402fe7ea2dc7b992" title="get last used name for a pattern, then add offset and return valid filename" alt="" coords="5,5,111,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_01fcd3835fb4e7d9331b722d86291b65.html">sw</a></li><li class="navelem"><a class="el" href="dir_5e9153041680afc3c016fd52fa730b56.html">airborne</a></li><li class="navelem"><a class="el" href="dir_c2abcdd6ccb39c3582929c0e3f5651c2.html">modules</a></li><li class="navelem"><a class="el" href="dir_cbf4be70f5fb954ea1d2a546dd70b40e.html">loggers</a></li><li class="navelem"><a class="el" href="dir_c27662836f6a804eadd3e3b5df5506a4.html">sdlog_chibios</a></li><li class="navelem"><a class="el" href="sdLog_8c.html">sdLog.c</a></li>
    <li class="footer">Generated on Sat Feb 19 2022 20:56:00 for Paparazzi UAS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
