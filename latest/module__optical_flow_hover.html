<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paparazzi UAS: optical_flow_hover module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td id="projectalign">
   <div id="projectname">Paparazzi UAS<span id="projectnumber">&#160;v7.0_unstable</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('module__optical_flow_hover.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">optical_flow_hover module</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>This module implements monocular vision height estimation and uses this</b></p>
<p>estimate to stabilize a quadrotor using only a downwards facing camera and an IMU. For scientific background please visit: <a href="https://repository.tudelft.nl/islandora/object/uuid%3A6e3ce742-a974-491d-97c2-1cafc090b3d9">https://repository.tudelft.nl/islandora/object/uuid%3A6e3ce742-a974-491d-97c2-1cafc090b3d9</a></p>
<p>The gain height relationship as first described in <a href="http://iopscience.iop.org/article/10.1088/1748-3190/11/1/016004">http://iopscience.iop.org/article/10.1088/1748-3190/11/1/016004</a> is calibrated in a controlled environment so that the resulting relationship can be used to determine the height at which the quadrotor is flying. In addition to the vertical axis the same principle is applied to the horizontal axes.</p>
<p>A short guide on how to determine the slope: Picking a relatively high OFH_RAMP* with a very high negative OFH_COV*_SETPOINT (i.e. -6000000), looking at when the quadrotor starts oscillating, the respective message (covariances.*) should be used to determine a suitable threshold value for OFH_COV*_SETPOINT. The slope can then be decreased to gain accuracy in reaching the oscillations. Finally when flying the quadrotor on different heights the gain at which instability occurs can be noted to determine the slope of the gain-height relationship.</p>
<p>Important settings: -OFH_HOVER_METHOD/hover_method: 0, the method is applied to all 3 axes in the following order: Z - X - Y 1, the method is applied to all 3 axes at the same time 2, the method is applied to the Z axis and the estimated height is used to determine the proper gains for the horizontal axes using the predetermined relationship.</p>
<p>-XY_SYMMETRICAL is set to 1 if the drone is roughly symmetrical, causing the found gains for the X axis is also used for the Y axis. -OFH_*GAIN* can be used to set starting gains to prevent initial drift while still estimating height and appropriate gains. -OFH_REDUCTION* is used to reduce the gain after determining the oscillation to stabilize the quadrotor.</p>
<h1><a class="anchor" id="module_load_example__optical_flow_hover"></a>
Example for airframe file</h1>
<p>Add to your firmware section: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optical_flow_hover&quot;</span>/&gt;</div>
</div><!-- fragment --> <h1><a class="anchor" id="functions__optical_flow_hover"></a>
Module functions</h1>
<h2><a class="anchor" id="init_functions"></a>
Init Functions</h2>
<p>These initialization functions are called once on startup.</p>
<ul>
<li><a class="el" href="optical__flow__hover_8c.html#ab066974e62c3e2267c4dfc11fc84d169">optical_flow_hover_init()</a></li>
</ul>
<h1><a class="anchor" id="files"></a>
Files</h1>
<h2><a class="anchor" id="headers"></a>
Header Files</h2>
<p>The following headers are automatically included in modules.h</p>
<ul>
<li><a class="el" href="optical__flow__hover_8h.html">optical_flow_hover.h</a></li>
<li><a class="el" href="optical__flow__functions_8h.html">optical_flow_functions.h</a></li>
</ul>
<h2><a class="anchor" id="sources"></a>
Source Files</h2>
<ul>
<li><a class="el" href="optical__flow__hover_8c.html">modules/ctrl/optical_flow_hover.c</a></li>
<li><a class="el" href="optical__flow__functions_8c.html">modules/ctrl/optical_flow_functions.c</a></li>
</ul>
<h2><a class="anchor" id="module_xml__optical_flow_hover"></a>
Raw optical_flow_hover.xml file:</h2>
<div class="fragment"><div class="line">&lt;!<span class="keyword">DOCTYPE</span> <span class="keyword">module</span> <span class="keyword">SYSTEM</span> <span class="stringliteral">&quot;module.dtd&quot;</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optical_flow_hover&quot;</span> <span class="keyword">dir</span>=<span class="stringliteral">&quot;ctrl&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">doc</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">description</span>&gt;</div>
<div class="line">  <span class="keyword">This</span> <span class="keyword">module</span> <span class="keyword">implements</span> <span class="keyword">monocular</span> <span class="keyword">vision</span> <span class="keyword">height</span> <span class="keyword">estimation</span> <span class="keyword">and</span> <span class="keyword">uses</span> <span class="keyword">this</span></div>
<div class="line">  <span class="keyword">estimate</span> <span class="keyword">to</span> <span class="keyword">stabilize</span> <span class="keyword">a</span> <span class="keyword">quadrotor</span> <span class="keyword">using</span> <span class="keyword">only</span> <span class="keyword">a</span> <span class="keyword">downwards</span></div>
<div class="line">  <span class="keyword">facing</span> <span class="keyword">camera</span> <span class="keyword">and</span> <span class="keyword">an</span> <span class="keyword">IMU.</span> <span class="keyword">For</span> <span class="keyword">scientific</span> <span class="keyword">background</span> <span class="keyword">please</span> <span class="keyword">visit:</span></div>
<div class="line">  <span class="keyword">https:</span>//<span class="keyword">repository.tudelft.nl</span>/<span class="keyword">islandora</span>/<span class="keyword">object</span>/<span class="keyword">uuid</span>%3<span class="keyword">A6e3ce742-a974-491d-97c2-1cafc090b3d9</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">The</span> <span class="keyword">gain</span> <span class="keyword">height</span> <span class="keyword">relationship</span> <span class="keyword">as</span> <span class="keyword">first</span> <span class="keyword">described</span> <span class="keyword">in</span></div>
<div class="line">  <span class="keyword">http:</span>//<span class="keyword">iopscience.iop.org</span>/<span class="keyword">article</span>/10.1088/1748-3190/11/1/016004 <span class="keyword">is</span></div>
<div class="line">  <span class="keyword">calibrated</span></div>
<div class="line">  <span class="keyword">in</span> <span class="keyword">a</span> <span class="keyword">controlled</span> <span class="keyword">environment</span> <span class="keyword">so</span> <span class="keyword">that</span> <span class="keyword">the</span> <span class="keyword">resulting</span> <span class="keyword">relationship</span> <span class="keyword">can</span> <span class="keyword">be</span></div>
<div class="line">  <span class="keyword">used</span> <span class="keyword">to</span> <span class="keyword">determine</span> <span class="keyword">the</span> <span class="keyword">height</span> <span class="keyword">at</span> <span class="keyword">which</span> <span class="keyword">the</span> <span class="keyword">quadrotor</span> <span class="keyword">is</span> <span class="keyword">flying.</span></div>
<div class="line">  <span class="keyword">In</span> <span class="keyword">addition</span> <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">vertical</span> <span class="keyword">axis</span> <span class="keyword">the</span> <span class="keyword">same</span> <span class="keyword">principle</span> <span class="keyword">is</span> <span class="keyword">applied</span> <span class="keyword">to</span> <span class="keyword">the</span></div>
<div class="line">  <span class="keyword">horizontal</span> <span class="keyword">axes.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">A</span> <span class="keyword">short</span> <span class="keyword">guide</span> <span class="keyword">on</span> <span class="keyword">how</span> <span class="keyword">to</span> <span class="keyword">determine</span> <span class="keyword">the</span> <span class="keyword">slope:</span></div>
<div class="line">  <span class="keyword">Picking</span> <span class="keyword">a</span> <span class="keyword">relatively</span> <span class="keyword">high</span> <span class="keyword">OFH_RAMP</span>* <span class="keyword">with</span> <span class="keyword">a</span> <span class="keyword">very</span> <span class="keyword">high</span> <span class="keyword">negative</span></div>
<div class="line">  <span class="keyword">OFH_COV</span>*<span class="keyword">_SETPOINT</span> (<span class="keyword">i.e.</span> -6000000),</div>
<div class="line">  <span class="keyword">looking</span> <span class="keyword">at</span> <span class="keyword">when</span> <span class="keyword">the</span> <span class="keyword">quadrotor</span> <span class="keyword">starts</span> <span class="keyword">oscillating</span>, <span class="keyword">the</span> <span class="keyword">respective</span> <span class="keyword">message</span></div>
<div class="line">  (<span class="keyword">covariances.</span>*) <span class="keyword">should</span> <span class="keyword">be</span> <span class="keyword">used</span> <span class="keyword">to</span> <span class="keyword">determine</span> <span class="keyword">a</span> <span class="keyword">suitable</span></div>
<div class="line">  <span class="keyword">threshold</span> <span class="keyword">value</span> <span class="keyword">for</span> <span class="keyword">OFH_COV</span>*<span class="keyword">_SETPOINT.</span> <span class="keyword">The</span> <span class="keyword">slope</span> <span class="keyword">can</span> <span class="keyword">then</span> <span class="keyword">be</span> <span class="keyword">decreased</span> <span class="keyword">to</span> <span class="keyword">gain</span></div>
<div class="line">  <span class="keyword">accuracy</span> <span class="keyword">in</span> <span class="keyword">reaching</span> <span class="keyword">the</span> <span class="keyword">oscillations.</span></div>
<div class="line">  <span class="keyword">Finally</span> <span class="keyword">when</span> <span class="keyword">flying</span> <span class="keyword">the</span> <span class="keyword">quadrotor</span> <span class="keyword">on</span> <span class="keyword">different</span> <span class="keyword">heights</span> <span class="keyword">the</span> <span class="keyword">gain</span> <span class="keyword">at</span> <span class="keyword">which</span></div>
<div class="line">  <span class="keyword">instability</span> <span class="keyword">occurs</span> <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">noted</span> <span class="keyword">to</span> <span class="keyword">determine</span> <span class="keyword">the</span> <span class="keyword">slope</span> <span class="keyword">of</span> <span class="keyword">the</span></div>
<div class="line">  <span class="keyword">gain-height</span> <span class="keyword">relationship.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">Important</span> <span class="keyword">settings:</span></div>
<div class="line">  -<span class="keyword">OFH_HOVER_METHOD</span>/<span class="keyword">hover_method:</span></div>
<div class="line">  0, <span class="keyword">the</span> <span class="keyword">method</span> <span class="keyword">is</span> <span class="keyword">applied</span> <span class="keyword">to</span> <span class="keyword">all</span> 3 <span class="keyword">axes</span> <span class="keyword">in</span> <span class="keyword">the</span> <span class="keyword">following</span> <span class="keyword">order:</span> <span class="keyword">Z</span> - <span class="keyword">X</span> - <span class="keyword">Y</span></div>
<div class="line">  1, <span class="keyword">the</span> <span class="keyword">method</span> <span class="keyword">is</span> <span class="keyword">applied</span> <span class="keyword">to</span> <span class="keyword">all</span> 3 <span class="keyword">axes</span> <span class="keyword">at</span> <span class="keyword">the</span> <span class="keyword">same</span> <span class="keyword">time</span></div>
<div class="line">  2, <span class="keyword">the</span> <span class="keyword">method</span> <span class="keyword">is</span> <span class="keyword">applied</span> <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">Z</span> <span class="keyword">axis</span> <span class="keyword">and</span> <span class="keyword">the</span> <span class="keyword">estimated</span> <span class="keyword">height</span> <span class="keyword">is</span> <span class="keyword">used</span></div>
<div class="line">  <span class="keyword">to</span> <span class="keyword">determine</span> <span class="keyword">the</span> <span class="keyword">proper</span> <span class="keyword">gains</span></div>
<div class="line">  <span class="keyword">for</span> <span class="keyword">the</span> <span class="keyword">horizontal</span> <span class="keyword">axes</span> <span class="keyword">using</span> <span class="keyword">the</span> <span class="keyword">predetermined</span> <span class="keyword">relationship.</span></div>
<div class="line"> </div>
<div class="line">  -<span class="keyword">XY_SYMMETRICAL</span> <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span> 1 <span class="keyword">if</span> <span class="keyword">the</span> <span class="keyword">drone</span> <span class="keyword">is</span> <span class="keyword">roughly</span> <span class="keyword">symmetrical</span>,</div>
<div class="line">  <span class="keyword">causing</span> <span class="keyword">the</span> <span class="keyword">found</span> <span class="keyword">gains</span> <span class="keyword">for</span> <span class="keyword">the</span> <span class="keyword">X</span> <span class="keyword">axis</span> <span class="keyword">is</span> <span class="keyword">also</span> <span class="keyword">used</span> <span class="keyword">for</span> <span class="keyword">the</span> <span class="keyword">Y</span> <span class="keyword">axis.</span></div>
<div class="line">  -<span class="keyword">OFH_</span>*<span class="keyword">GAIN</span>* <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">used</span> <span class="keyword">to</span> <span class="keyword">set</span> <span class="keyword">starting</span> <span class="keyword">gains</span> <span class="keyword">to</span> <span class="keyword">prevent</span> <span class="keyword">initial</span> <span class="keyword">drift</span></div>
<div class="line">  <span class="keyword">while</span> <span class="keyword">still</span> <span class="keyword">estimating</span> <span class="keyword">height</span> <span class="keyword">and</span> <span class="keyword">appropriate</span> <span class="keyword">gains.</span></div>
<div class="line">  -<span class="keyword">OFH_REDUCTION</span>* <span class="keyword">is</span> <span class="keyword">used</span> <span class="keyword">to</span> <span class="keyword">reduce</span> <span class="keyword">the</span> <span class="keyword">gain</span> <span class="keyword">after</span> <span class="keyword">determining</span> <span class="keyword">the</span> <span class="keyword">oscillation</span> <span class="keyword">to</span></div>
<div class="line">  <span class="keyword">stabilize</span> <span class="keyword">the</span> <span class="keyword">quadrotor.</span></div>
<div class="line"> </div>
<div class="line">    &lt;/<span class="keywordtype">description</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">doc</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">settings</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">dl_settings</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;OpticalFlowHover&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_settings</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;General&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;cov_method&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">values</span>=<span class="stringliteral">&quot;input|past&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;COV_METHOD&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_COV_METHOD&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;hover_method&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">values</span>=<span class="stringliteral">&quot;Sub|Same|Smart&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;HOVER_METHOD&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_HOVER_METHOD&quot;</span>/&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">dl_settings</span>&gt;            </div>
<div class="line">        &lt;<span class="keywordtype">dl_settings</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Vertical&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Z.cov_setpoint&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;-5.05&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;covDiv_set_point&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_COVDIV_SETPOINT&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Z.ramp&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.005&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;rampZ&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_RAMPZ&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Z.reduction_factor&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.1&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;reduction_factorZ&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_REDUCTIONZ&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Z.PID.P&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;pgainZ&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Z.PID.I&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;igainZ&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_IGAINZ&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Z.PID.D&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;dgainZ&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_DGAINZ&quot;</span>/&gt;              </div>
<div class="line">        &lt;/<span class="keywordtype">dl_settings</span>&gt;            </div>
<div class="line">        &lt;<span class="keywordtype">dl_settings</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Horizontal&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_X.cov_setpoint&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;-100000&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;100&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;10000&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;covFlow_set_pointX&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_COVDIV_SETPOINT&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Y.cov_setpoint&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;-100000&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;100&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;10000&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;covFlow_set_pointY&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_COVDIV_SETPOINT&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_X.ramp&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.0001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.05&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;rampX&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_RAMPXY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Y.ramp&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.0001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.05&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;rampY&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_RAMPXY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_X.reduction_factor&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.1&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;reduction_factorX&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_REDUCTIONXY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Y.reduction_factor&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.1&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;reduction_factorY&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_REDUCTIONXY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_X.PID.P&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;pgainX&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_X.PID.I&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.001&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;IgainX&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_IGAINX&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_X.PID.D&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.001&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;DgainX&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_DGAINX&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Y.PID.P&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;pgainY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Y.PID.I&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.001&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;IgainY&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_IGAINY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;of_hover_ctrl_Y.PID.D&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.00001&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.001&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;DgainY&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;OFH_DGAINY&quot;</span>/&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;oscphi&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">values</span>=<span class="stringliteral">&quot;No|OSC&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;oscphi&quot;</span> /&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;osctheta&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">values</span>=<span class="stringliteral">&quot;No|OSC&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;osctheta&quot;</span> /&gt;</div>
<div class="line">          &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;derotated&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">values</span>=<span class="stringliteral">&quot;Reg|Der&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;ctrl/optical_flow_hover&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;derotated&quot;</span> /&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">settings</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">header</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optical_flow_hover.h&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optical_flow_functions.h&quot;</span> /&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">header</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">init</span> <span class="keyword">fun</span>=<span class="stringliteral">&quot;optical_flow_hover_init()&quot;</span> /&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">makefile</span> <span class="keyword">target</span>=<span class="stringliteral">&quot;ap&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optical_flow_hover.c&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optical_flow_functions.c&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">test</span> <span class="keyword">firmware</span>=<span class="stringliteral">&quot;rotorcraft&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;COV_WINDOW_SIZE&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;300&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;GUIDANCE_H_MAX_BANK&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0.5&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;GUIDANCE_H_PGAIN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;GUIDANCE_H_IGAIN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;GUIDANCE_H_DGAIN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">test</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">makefile</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="onboard_modules.html">Onboard Modules</a></li>
    <li class="footer">Generated on Wed Jun 25 2025 11:32:56 for Paparazzi UAS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
