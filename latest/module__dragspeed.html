<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paparazzi UAS: dragspeed module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td id="projectalign">
   <div id="projectname">Paparazzi UAS<span id="projectnumber">&#160;v7.0_unstable</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('module__dragspeed.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">dragspeed module</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Estimate the velocity/airspeed of rotorcraft by measuring the drag force.</b></p>
<p><b></b></p>
<div class="image">
<img src="dragspeed.png" alt=""/>
</div>
<p>During flight, gravity, thrust and drag act on the quadrotor. Gravity is not measured by accelerometers and the thrust only acts along the drone's vertical axis. Therefore, only the drag is measured along the quadrotor's horizontal axes. Using a simple linear drag model, this deceleration can be transformed back into an estimate of the drone's airspeed.</p>
<p>The advantages of this method are that the acceleration is not integrated over time (the only source of drift is the drift of the sensor itself) and that no knowledge of the quadrotor's attitude or other states is required.</p>
<p>This module makes the following assumptions:</p><ul>
<li>The drag acting on the quadrotor grows linearly with velocity.</li>
<li>The size and weight of the drone are constant (changes in size and/or weight require re-calibration).</li>
<li>Pitch and roll angles are small (less than ~20 deg).</li>
<li>No wind (when used as ground speed).</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Usage instructions</h2>
<ol type="1">
<li>Calibrate zero (recommended before each flight)<ol type="a">
<li>For the best results, ensure that the INS velocity is as accurate as possible (e.g. use Optitrack and set the INS type to gps_passthrough) and set DRAGSPEED_SEND_ABI_MESSAGE to FALSE.</li>
<li>Bring the drone to a stationary hover.</li>
<li>In the GCS under settings/dragspeed, set "Calibrate Zero" to 1.</li>
<li>Keep the drone stationary until "Calibrate Zero" returns to 0.</li>
<li>(Optional) Copy the new Zero_X and Zero_Y values to the DRAGSPEED_ZERO_X and _Y defines in the airframe file.</li>
</ol>
</li>
<li>Calibrate drag coefficient (new airframes or after change in weight or shape)<ol type="a">
<li>For the best results, ensure that the INS velocity is as accurate as possible (e.g. use Optitrack and set the INS type to gps_passthrough) and set DRAGSPEED_SEND_ABI_MESSAGE to FALSE.</li>
<li>Ensure the zero measurement is calibrated first. Drag coefficient calibration will not start unless Zero_X and _Y values are available.</li>
<li>In the GCS under settings/dragspeed, set "Calibrate Coeff" to 1.</li>
<li>Fly the drone around along the body x and y axes. The drag coefficient is updated at speeds larger than 0.5m/s.</li>
<li>Calibration is finished when "Calibrate Coeff" returns to 0. Check the results by comparing the estimated and INS velocities in the DRAGSPEED telemetry message.</li>
<li>Copy the new Coeff_X and Coeff_Y values to the DRAGSPEED_COEFF_X and _Y defines in the airframe file.</li>
</ol>
</li>
<li>By default, the estimated velocity is sent through the VELOCITY_ESTIMATE ABI message to the INS. The estimated velocity can also be read from the dragspeed struct.</li>
</ol>
<h2><a class="anchor" id="autotoc_md8"></a>
Calibration from flight plan</h2>
<p>Calibration can be started from the flight plan by calling <a class="el" href="dragspeed_8c.html#aa68d99d92ba11545eeb1549c3c79356f">dragspeed_calibrate_zero()</a> or <a class="el" href="dragspeed_8c.html#a5c21b501ec7ade0a1a9e697273ba7943">dragspeed_calibrate_coeff()</a>. Progress of the calibration can be monitored through <a class="el" href="dragspeed_8c.html#a0bd8af2072b7da171abf0b1787e03766">dragspeed_is_calibrating()</a>, which returns TRUE while either calibration routine is in progress.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Example results</h2>
<p>The following results were obtained from a flight test performed on an AR.Drone 2.0 inside the TU Delft Cyberzoo. The ground-truth velocities are obtained through the Optitrack system.</p>
<div class="image">
<img src="example_result.png" alt=""/>
</div>
<p>The following settings were used:</p><ul>
<li>DRAGSPEED_COEFF_X = 0.62</li>
<li>DRAGSPEED_COEFF_Y = 0.85</li>
<li>DRAGSPEED_FILTER = 0.8</li>
</ul>
<h1><a class="anchor" id="module_load_example__dragspeed"></a>
Example for airframe file</h1>
<p>Add to your firmware section: This example contains all possible configuration options, not all of them are mandatory! </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dragspeed&quot;</span>&gt;</div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_SEND_ABI_MESSAGE&quot; value=&quot;TRUE|FALSE (default: TRUE)&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_ACCEL_ID&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_COEFF_X&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_COEFF_Y&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_ZERO_X&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_ZERO_Y&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_R&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;DRAGSPEED_FILTER&quot; /&gt;\n  &#39;</span></div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
</div><!-- fragment --> <h1><a class="anchor" id="configuration__dragspeed"></a>
Module configuration options</h1>
<h2><a class="anchor" id="define"></a>
Define Options</h2>
<ul>
<li><b>name:</b> <code>DRAGSPEED_SEND_ABI_MESSAGE</code> <b>value:</b> <em>TRUE|FALSE (default: TRUE)</em> <br  />
 Description: Send VELOCITY_ESTIMATE ABI messages</li>
<li><b>name:</b> <code>DRAGSPEED_ACCEL_ID</code> <b>value:</b> <em>None</em> <br  />
 Description: Accelerometer ABI ID to subscribe to (default: ABI_BROADCAST)</li>
<li><b>name:</b> <code>DRAGSPEED_COEFF_X</code> <b>value:</b> <em>None</em> <br  />
 Description: Drag coefficient (mu/m) of the linear drag model along the body x axis, where m*a = v*mu</li>
<li><b>name:</b> <code>DRAGSPEED_COEFF_Y</code> <b>value:</b> <em>None</em> <br  />
 Description: Drag coefficient (mu/m) of the linear drag model along the body y axis, where m*a = v*mu</li>
<li><b>name:</b> <code>DRAGSPEED_ZERO_X</code> <b>value:</b> <em>None</em> <br  />
 Description: Accelerometer reading (x axis) when stationary [m/s^2]</li>
<li><b>name:</b> <code>DRAGSPEED_ZERO_Y</code> <b>value:</b> <em>None</em> <br  />
 Description: Accelerometer reading (y axis) when stationary [m/s^2]</li>
<li><b>name:</b> <code>DRAGSPEED_R</code> <b>value:</b> <em>None</em> <br  />
 Description: Velocity measurement noise variance [(m/s)^2]</li>
<li><b>name:</b> <code>DRAGSPEED_FILTER</code> <b>value:</b> <em>None</em> <br  />
 Description: First-order low-pass filter strength [0..1] (default: 0.8)</li>
</ul>
<h1><a class="anchor" id="functions__dragspeed"></a>
Module functions</h1>
<h2><a class="anchor" id="init_functions"></a>
Init Functions</h2>
<p>These initialization functions are called once on startup.</p>
<ul>
<li><a class="el" href="dragspeed_8c.html#a05d45f13ce0a7459512936aff9e9ad29">dragspeed_init()</a></li>
</ul>
<h1><a class="anchor" id="files"></a>
Files</h1>
<h2><a class="anchor" id="headers"></a>
Header Files</h2>
<p>The following headers are automatically included in modules.h</p>
<ul>
<li><a class="el" href="dragspeed_8h.html">dragspeed.h</a></li>
</ul>
<h2><a class="anchor" id="sources"></a>
Source Files</h2>
<ul>
<li><a class="el" href="dragspeed_8c.html">modules/dragspeed/dragspeed.c</a></li>
</ul>
<h2><a class="anchor" id="module_xml__dragspeed"></a>
Raw dragspeed.xml file:</h2>
<div class="fragment"><div class="line">&lt;!<span class="keyword">DOCTYPE</span> <span class="keyword">module</span> <span class="keyword">SYSTEM</span> <span class="stringliteral">&quot;module.dtd&quot;</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dragspeed&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">doc</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">description</span>&gt;</div>
<div class="line">      <span class="keyword">Estimate</span> <span class="keyword">the</span> <span class="keyword">velocity</span>/<span class="keyword">airspeed</span> <span class="keyword">of</span> <span class="keyword">rotorcraft</span> <span class="keyword">by</span> <span class="keyword">measuring</span> <span class="keyword">the</span> <span class="keyword">drag</span> <span class="keyword">force.</span></div>
<div class="line">      </div>
<div class="line">      @<span class="keyword">image</span> <span class="keyword">html</span> <span class="keyword">images</span>/<span class="keyword">airborne</span>/<span class="keyword">modules</span>/<span class="keyword">dragspeed</span>/<span class="keyword">dragspeed.png</span></div>
<div class="line">   </div>
<div class="line">      <span class="keyword">During</span> <span class="keyword">flight</span>, <span class="keyword">gravity</span>, <span class="keyword">thrust</span> <span class="keyword">and</span> <span class="keyword">drag</span> <span class="keyword">act</span> <span class="keyword">on</span> <span class="keyword">the</span> <span class="keyword">quadrotor.</span></div>
<div class="line">      <span class="keyword">Gravity</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">measured</span> <span class="keyword">by</span> <span class="keyword">accelerometers</span> <span class="keyword">and</span> <span class="keyword">the</span> <span class="keyword">thrust</span> <span class="keyword">only</span> <span class="keyword">acts</span> <span class="keyword">along</span></div>
<div class="line">      <span class="keyword">the</span> <span class="keyword">drone</span><span class="stringliteral">&#39;s vertical axis. Therefore, only the drag is measured along the </span></div>
<div class="line"><span class="stringliteral">      quadrotor&#39;</span><span class="keyword">s</span> <span class="keyword">horizontal</span> <span class="keyword">axes.</span> <span class="keyword">Using</span> <span class="keyword">a</span> <span class="keyword">simple</span> <span class="keyword">linear</span> <span class="keyword">drag</span> <span class="keyword">model</span>, <span class="keyword">this</span> </div>
<div class="line">      <span class="keyword">deceleration</span> <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">transformed</span> <span class="keyword">back</span> <span class="keyword">into</span> <span class="keyword">an</span> <span class="keyword">estimate</span> <span class="keyword">of</span> <span class="keyword">the</span> <span class="keyword">drone</span><span class="stringliteral">&#39;s</span></div>
<div class="line"><span class="stringliteral">      airspeed.</span></div>
<div class="line"><span class="stringliteral">      </span></div>
<div class="line"><span class="stringliteral">      The advantages of this method are that the acceleration is not integrated</span></div>
<div class="line"><span class="stringliteral">      over time (the only source of drift is the drift of the sensor itself)</span></div>
<div class="line"><span class="stringliteral">      and that no knowledge of the quadrotor&#39;</span><span class="keyword">s</span> <span class="keyword">attitude</span> <span class="keyword">or</span> <span class="keyword">other</span> <span class="keyword">states</span> <span class="keyword">is</span></div>
<div class="line">      <span class="keyword">required.</span></div>
<div class="line">   </div>
<div class="line">      <span class="keyword">This</span> <span class="keyword">module</span> <span class="keyword">makes</span> <span class="keyword">the</span> <span class="keyword">following</span> <span class="keyword">assumptions:</span></div>
<div class="line">      - <span class="keyword">The</span> <span class="keyword">drag</span> <span class="keyword">acting</span> <span class="keyword">on</span> <span class="keyword">the</span> <span class="keyword">quadrotor</span> <span class="keyword">grows</span> <span class="keyword">linearly</span> <span class="keyword">with</span> <span class="keyword">velocity.</span></div>
<div class="line">      - <span class="keyword">The</span> <span class="keyword">size</span> <span class="keyword">and</span> <span class="keyword">weight</span> <span class="keyword">of</span> <span class="keyword">the</span> <span class="keyword">drone</span> <span class="keyword">are</span> <span class="keyword">constant</span> (<span class="keyword">changes</span> <span class="keyword">in</span> <span class="keyword">size</span> <span class="keyword">and</span>/<span class="keyword">or</span></div>
<div class="line">        <span class="keyword">weight</span> <span class="keyword">require</span> <span class="keyword">re-calibration</span>).</div>
<div class="line">      - <span class="keyword">Pitch</span> <span class="keyword">and</span> <span class="keyword">roll</span> <span class="keyword">angles</span> <span class="keyword">are</span> <span class="keyword">small</span> (<span class="keyword">less</span> <span class="keyword">than</span> ~20 <span class="keyword">deg</span>).</div>
<div class="line">      - <span class="keyword">No</span> <span class="keyword">wind</span> (<span class="keyword">when</span> <span class="keyword">used</span> <span class="keyword">as</span> <span class="keyword">ground</span> <span class="keyword">speed</span>).</div>
<div class="line">      </div>
<div class="line">      </div>
<div class="line">      <span class="keyword">Usage</span> <span class="keyword">instructions</span></div>
<div class="line">      ------------------</div>
<div class="line">      1. <span class="keyword">Calibrate</span> <span class="keyword">zero</span> (<span class="keyword">recommended</span> <span class="keyword">before</span> <span class="keyword">each</span> <span class="keyword">flight</span>)</div>
<div class="line">         1. <span class="keyword">For</span> <span class="keyword">the</span> <span class="keyword">best</span> <span class="keyword">results</span>, <span class="keyword">ensure</span> <span class="keyword">that</span> <span class="keyword">the</span> <span class="keyword">INS</span> <span class="keyword">velocity</span> <span class="keyword">is</span> <span class="keyword">as</span> <span class="keyword">accurate</span> <span class="keyword">as</span></div>
<div class="line">            <span class="keyword">possible</span> (<span class="keyword">e.g.</span> <span class="keyword">use</span> <span class="keyword">Optitrack</span> <span class="keyword">and</span> <span class="keyword">set</span> <span class="keyword">the</span> <span class="keyword">INS</span> <span class="keyword">type</span> <span class="keyword">to</span></div>
<div class="line">            <span class="keyword">gps_passthrough</span>) <span class="keyword">and</span> <span class="keyword">set</span> <span class="keyword">DRAGSPEED_SEND_ABI_MESSAGE</span> <span class="keyword">to</span> <span class="keyword">FALSE.</span></div>
<div class="line">         2. <span class="keyword">Bring</span> <span class="keyword">the</span> <span class="keyword">drone</span> <span class="keyword">to</span> <span class="keyword">a</span> <span class="keyword">stationary</span> <span class="keyword">hover.</span></div>
<div class="line">         3. <span class="keyword">In</span> <span class="keyword">the</span> <span class="keyword">GCS</span> <span class="keyword">under</span> <span class="keyword">settings</span>/<span class="keyword">dragspeed</span>, <span class="keyword">set</span> <span class="stringliteral">&quot;Calibrate Zero&quot;</span> <span class="keyword">to</span> 1.</div>
<div class="line">         4. <span class="keyword">Keep</span> <span class="keyword">the</span> <span class="keyword">drone</span> <span class="keyword">stationary</span> <span class="keyword">until</span> <span class="stringliteral">&quot;Calibrate Zero&quot;</span> <span class="keyword">returns</span> <span class="keyword">to</span> 0.</div>
<div class="line">         5. (<span class="keyword">Optional</span>) <span class="keyword">Copy</span> <span class="keyword">the</span> <span class="keyword">new</span> <span class="keyword">Zero_X</span> <span class="keyword">and</span> <span class="keyword">Zero_Y</span> <span class="keyword">values</span> <span class="keyword">to</span> <span class="keyword">the</span></div>
<div class="line">            <span class="keyword">DRAGSPEED_ZERO_X</span> <span class="keyword">and</span> <span class="keyword">_Y</span> <span class="keyword">defines</span> <span class="keyword">in</span> <span class="keyword">the</span> <span class="keyword">airframe</span> <span class="keyword">file.</span></div>
<div class="line">      2. <span class="keyword">Calibrate</span> <span class="keyword">drag</span> <span class="keyword">coefficient</span> (<span class="keyword">new</span> <span class="keyword">airframes</span> <span class="keyword">or</span> <span class="keyword">after</span> <span class="keyword">change</span> <span class="keyword">in</span> <span class="keyword">weight</span> <span class="keyword">or</span> </div>
<div class="line">         <span class="keyword">shape</span>)</div>
<div class="line">         1. <span class="keyword">For</span> <span class="keyword">the</span> <span class="keyword">best</span> <span class="keyword">results</span>, <span class="keyword">ensure</span> <span class="keyword">that</span> <span class="keyword">the</span> <span class="keyword">INS</span> <span class="keyword">velocity</span> <span class="keyword">is</span> <span class="keyword">as</span> <span class="keyword">accurate</span> <span class="keyword">as</span></div>
<div class="line">            <span class="keyword">possible</span> (<span class="keyword">e.g.</span> <span class="keyword">use</span> <span class="keyword">Optitrack</span> <span class="keyword">and</span> <span class="keyword">set</span> <span class="keyword">the</span> <span class="keyword">INS</span> <span class="keyword">type</span> <span class="keyword">to</span> </div>
<div class="line">            <span class="keyword">gps_passthrough</span>) <span class="keyword">and</span> <span class="keyword">set</span> <span class="keyword">DRAGSPEED_SEND_ABI_MESSAGE</span> <span class="keyword">to</span> <span class="keyword">FALSE.</span></div>
<div class="line">         2. <span class="keyword">Ensure</span> <span class="keyword">the</span> <span class="keyword">zero</span> <span class="keyword">measurement</span> <span class="keyword">is</span> <span class="keyword">calibrated</span> <span class="keyword">first.</span> <span class="keyword">Drag</span> <span class="keyword">coefficient</span></div>
<div class="line">            <span class="keyword">calibration</span> <span class="keyword">will</span> <span class="keyword">not</span> <span class="keyword">start</span> <span class="keyword">unless</span> <span class="keyword">Zero_X</span> <span class="keyword">and</span> <span class="keyword">_Y</span> <span class="keyword">values</span> <span class="keyword">are</span></div>
<div class="line">            <span class="keyword">available.</span></div>
<div class="line">         3. <span class="keyword">In</span> <span class="keyword">the</span> <span class="keyword">GCS</span> <span class="keyword">under</span> <span class="keyword">settings</span>/<span class="keyword">dragspeed</span>, <span class="keyword">set</span> <span class="stringliteral">&quot;Calibrate Coeff&quot;</span> <span class="keyword">to</span> 1.</div>
<div class="line">         4. <span class="keyword">Fly</span> <span class="keyword">the</span> <span class="keyword">drone</span> <span class="keyword">around</span> <span class="keyword">along</span> <span class="keyword">the</span> <span class="keyword">body</span> <span class="keyword">x</span> <span class="keyword">and</span> <span class="keyword">y</span> <span class="keyword">axes.</span> <span class="keyword">The</span> <span class="keyword">drag</span></div>
<div class="line">            <span class="keyword">coefficient</span> <span class="keyword">is</span> <span class="keyword">updated</span> <span class="keyword">at</span> <span class="keyword">speeds</span> <span class="keyword">larger</span> <span class="keyword">than</span> 0.5<span class="keyword">m</span>/<span class="keyword">s.</span></div>
<div class="line">         5. <span class="keyword">Calibration</span> <span class="keyword">is</span> <span class="keyword">finished</span> <span class="keyword">when</span> <span class="stringliteral">&quot;Calibrate Coeff&quot;</span> <span class="keyword">returns</span> <span class="keyword">to</span> 0. <span class="keyword">Check</span></div>
<div class="line">            <span class="keyword">the</span> <span class="keyword">results</span> <span class="keyword">by</span> <span class="keyword">comparing</span> <span class="keyword">the</span> <span class="keyword">estimated</span> <span class="keyword">and</span> <span class="keyword">INS</span> <span class="keyword">velocities</span> <span class="keyword">in</span> <span class="keyword">the</span></div>
<div class="line">            <span class="keyword">DRAGSPEED</span> <span class="keyword">telemetry</span> <span class="keyword">message.</span></div>
<div class="line">         6. <span class="keyword">Copy</span> <span class="keyword">the</span> <span class="keyword">new</span> <span class="keyword">Coeff_X</span> <span class="keyword">and</span> <span class="keyword">Coeff_Y</span> <span class="keyword">values</span> <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">DRAGSPEED_COEFF_X</span></div>
<div class="line">            <span class="keyword">and</span> <span class="keyword">_Y</span> <span class="keyword">defines</span> <span class="keyword">in</span> <span class="keyword">the</span> <span class="keyword">airframe</span> <span class="keyword">file.</span></div>
<div class="line">      3. <span class="keyword">By</span> <span class="keyword">default</span>, <span class="keyword">the</span> <span class="keyword">estimated</span> <span class="keyword">velocity</span> <span class="keyword">is</span> <span class="keyword">sent</span> <span class="keyword">through</span> <span class="keyword">the</span></div>
<div class="line">         <span class="keyword">VELOCITY_ESTIMATE</span> <span class="keyword">ABI</span> <span class="keyword">message</span> <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">INS.</span> <span class="keyword">The</span> <span class="keyword">estimated</span> <span class="keyword">velocity</span> <span class="keyword">can</span></div>
<div class="line">         <span class="keyword">also</span> <span class="keyword">be</span> <span class="keyword">read</span> <span class="keyword">from</span> <span class="keyword">the</span> <span class="keyword">dragspeed</span> <span class="keyword">struct.</span></div>
<div class="line">      </div>
<div class="line">      </div>
<div class="line">      <span class="keyword">Calibration</span> <span class="keyword">from</span> <span class="keyword">flight</span> <span class="keyword">plan</span></div>
<div class="line">      ----------------------------</div>
<div class="line">      <span class="keyword">Calibration</span> <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">started</span> <span class="keyword">from</span> <span class="keyword">the</span> <span class="keyword">flight</span> <span class="keyword">plan</span> <span class="keyword">by</span> <span class="keyword">calling</span></div>
<div class="line">      <span class="keyword">dragspeed_calibrate_zero</span>() <span class="keyword">or</span> <span class="keyword">dragspeed_calibrate_coeff</span>(). <span class="keyword">Progress</span> <span class="keyword">of</span> <span class="keyword">the</span></div>
<div class="line">      <span class="keyword">calibration</span> <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">monitored</span> <span class="keyword">through</span> <span class="keyword">dragspeed_is_calibrating</span>(), <span class="keyword">which</span></div>
<div class="line">      <span class="keyword">returns</span> <span class="keyword">TRUE</span> <span class="keyword">while</span> <span class="keyword">either</span> <span class="keyword">calibration</span> <span class="keyword">routine</span> <span class="keyword">is</span> <span class="keyword">in</span> <span class="keyword">progress.</span></div>
<div class="line">      </div>
<div class="line">      </div>
<div class="line">      <span class="keyword">Example</span> <span class="keyword">results</span></div>
<div class="line">      ---------------</div>
<div class="line">      <span class="keyword">The</span> <span class="keyword">following</span> <span class="keyword">results</span> <span class="keyword">were</span> <span class="keyword">obtained</span> <span class="keyword">from</span> <span class="keyword">a</span> <span class="keyword">flight</span> <span class="keyword">test</span> <span class="keyword">performed</span> <span class="keyword">on</span> <span class="keyword">an</span></div>
<div class="line">      <span class="keyword">AR.Drone</span> 2.0 <span class="keyword">inside</span> <span class="keyword">the</span> <span class="keyword">TU</span> <span class="keyword">Delft</span> <span class="keyword">Cyberzoo.</span> <span class="keyword">The</span> <span class="keyword">ground-truth</span> <span class="keyword">velocities</span></div>
<div class="line">      <span class="keyword">are</span> <span class="keyword">obtained</span> <span class="keyword">through</span> <span class="keyword">the</span> <span class="keyword">Optitrack</span> <span class="keyword">system.</span></div>
<div class="line">      </div>
<div class="line">      @<span class="keyword">image</span> <span class="keyword">html</span> <span class="keyword">images</span>/<span class="keyword">airborne</span>/<span class="keyword">modules</span>/<span class="keyword">dragspeed</span>/<span class="keyword">example_result.png</span></div>
<div class="line">      </div>
<div class="line">      <span class="keyword">The</span> <span class="keyword">following</span> <span class="keyword">settings</span> <span class="keyword">were</span> <span class="keyword">used:</span></div>
<div class="line">      - <span class="keyword">DRAGSPEED_COEFF_X</span> = 0.62</div>
<div class="line">      - <span class="keyword">DRAGSPEED_COEFF_Y</span> = 0.85</div>
<div class="line">      - <span class="keyword">DRAGSPEED_FILTER</span> = 0.8</div>
<div class="line">      </div>
<div class="line">    &lt;/<span class="keywordtype">description</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_SEND_ABI_MESSAGE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Send VELOCITY_ESTIMATE ABI messages&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;TRUE|FALSE (default: TRUE)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_ACCEL_ID&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Accelerometer ABI ID to subscribe to (default: ABI_BROADCAST)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_COEFF_X&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Drag coefficient (mu/m) of the linear drag model along the body x axis, where m*a = v*mu&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_COEFF_Y&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Drag coefficient (mu/m) of the linear drag model along the body y axis, where m*a = v*mu&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_ZERO_X&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Accelerometer reading (x axis) when stationary [m/s^2]&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_ZERO_Y&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Accelerometer reading (y axis) when stationary [m/s^2]&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_R&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Velocity measurement noise variance [(m/s)^2]&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DRAGSPEED_FILTER&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;First-order low-pass filter strength [0..1] (default: 0.8)&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">doc</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">settings</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">dl_settings</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dragspeed&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Calibrate zero&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.calibrate_zero&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Zero_X&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.zero.x&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;-2.0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;2.0&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Zero_Y&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.zero.y&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;-2.0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;2.0&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Calibrate coeff&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.calibrate_coeff&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Coeff X&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.coeff.x&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;2.0&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Coeff Y&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.coeff.y&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;2.0&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;Filter&quot;</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;dragspeed.filter&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1.0&quot;</span>/&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">settings</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">header</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dragspeed.h&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">header</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">init</span> <span class="keyword">fun</span>=<span class="stringliteral">&quot;dragspeed_init()&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">makefile</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dragspeed.c&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">makefile</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
<div class="line"> </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="onboard_modules.html">Onboard Modules</a></li>
    <li class="footer">Generated on Fri Aug 15 2025 13:36:01 for Paparazzi UAS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
