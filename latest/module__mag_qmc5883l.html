<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paparazzi UAS: mag_qmc5883l module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td id="projectalign">
   <div id="projectname">Paparazzi UAS<span id="projectnumber">&#160;v7.0_unstable</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('module__mag_qmc5883l.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">mag_qmc5883l module</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Module to be able to use an QMC5883L magnetometer.</b></p>
<p><b></b></p>
<p>Intorduction: Honeywell discontinued the HMC5983/HMC5883L in 2016 and licensed the technology to QST Corporation, who now manufacture the replacement QMC5883L. However, while the QMC5883L is pin compatible with HMC, it's registers are not the same as the Honeywell device. It's essentially a different chip.</p>
<p>QST Corporation have produced two versions of the QMC5883L: A completely undocumented 'A' version with "DA 5883" on the QFN package that responds to the I2C address 0x1E. It's identical to the HMC5983/HMC5883L, except that the status register doesn't work. The DA 5883 is not supported by this driver since we have not seen any samples of this DA version in the wild</p>
<p>A documented 'B' version with "DB 5833" on the QFN package that responds to I2C address 0x0D. This works as per the QMC5883L datasheet.</p>
<p>TIP: An arbitrary rotation between the sensor frame and the IMU frame can be compensated with a MAG_TO_IMU rotation, defined by three euler angles. The three angles must be defined to enable this correction. Otherwise it is assumed that the IMU and MAG axis are aligned.</p>
<h1><a class="anchor" id="module_load_example__mag_qmc5883l"></a>
Example for airframe file</h1>
<p>Add to your firmware section: This example contains all possible configuration options, not all of them are mandatory! </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mag_qmc5883l&quot;</span>&gt;</div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;MODULE_QMC5883L_SYNC_SEND&quot; value=&quot;TRUE|FALSE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;MODULE_QMC5883L_UPDATE_AHRS&quot; value=&quot;TRUE|FALSE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;QMC5883L_CHAN_X_SIGN&quot; value=&quot;+|-&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;QMC5883L_CHAN_Y_SIGN&quot; value=&quot;+|-&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;QMC5883L_CHAN_Z_SIGN&quot; value=&quot;+|-&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;QMC5883L_CHAN_X&quot; value=&quot;0|1|2&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;QMC5883L_CHAN_Y&quot; value=&quot;0|1|2&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;QMC5883L_CHAN_Z&quot; value=&quot;0|1|2&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;configure name=&quot;MAG_QMC5883L_I2C_DEV&quot; value=&quot;i2c1&quot; /&gt;\n    &#39;</span></div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
</div><!-- fragment --> <h1><a class="anchor" id="configuration__mag_qmc5883l"></a>
Module configuration options</h1>
<h2><a class="anchor" id="configure"></a>
Configure Options</h2>
<ul>
<li><b>name:</b> <code>MAG_QMC5883L_I2C_DEV</code> <b>value:</b> <em>i2c1</em> <br  />
 Description: I2C device to use (e.g. i2c2)</li>
</ul>
<h2><a class="anchor" id="define"></a>
Define Options</h2>
<ul>
<li><b>name:</b> <code>MODULE_QMC5883L_SYNC_SEND</code> <b>value:</b> <em>TRUE|FALSE</em> <br  />
 Description: Send IMU_RAW message with each new measurement for debugging purposes (default: FALSE)</li>
<li><b>name:</b> <code>MODULE_QMC5883L_UPDATE_AHRS</code> <b>value:</b> <em>TRUE|FALSE</em> <br  />
 Description: Copy measurements to IMU and send as ABI message (default: FALSE)</li>
<li><b>name:</b> <code>QMC5883L_CHAN_X_SIGN</code> <b>value:</b> <em>+|-</em> <br  />
 Description: Set the polarity of x axis (default: +)</li>
<li><b>name:</b> <code>QMC5883L_CHAN_Y_SIGN</code> <b>value:</b> <em>+|-</em> <br  />
 Description: Set the polarity of y axis (default: +)</li>
<li><b>name:</b> <code>QMC5883L_CHAN_Z_SIGN</code> <b>value:</b> <em>+|-</em> <br  />
 Description: Set the polarity of z axis (default: +)</li>
<li><b>name:</b> <code>QMC5883L_CHAN_X</code> <b>value:</b> <em>0|1|2</em> <br  />
 Description: Channel id of x axis (default: 0)</li>
<li><b>name:</b> <code>QMC5883L_CHAN_Y</code> <b>value:</b> <em>0|1|2</em> <br  />
 Description: Channel id of y axis (default: 1)</li>
<li><b>name:</b> <code>QMC5883L_CHAN_Z</code> <b>value:</b> <em>0|1|2</em> <br  />
 Description: Channel id of z axis (default: 2)</li>
</ul>
<h2><a class="anchor" id="af_section"></a>
Airframe file section</h2>
<ul>
<li><b>section</b> name: <code>MAG_QMC</code> prefix: <code>QMC5883L_</code> <ul>
<li><b>name</b> <code>MAG_TO_IMU_PHI</code> <b>value:</b> <em>0.0</em> <br  />
 Description: Rotation between sensor frame and IMU frame (phi angle)</li>
<li><b>name</b> <code>MAG_TO_IMU_THETA</code> <b>value:</b> <em>0.0</em> <br  />
 Description: Rotation between sensor frame and IMU frame (theta angle)</li>
<li><b>name</b> <code>MAG_TO_IMU_PSI</code> <b>value:</b> <em>0.0</em> <br  />
 Description: Rotation between sensor frame and IMU frame (psi angle)</li>
<li><b>name</b> <code>DATA_RATE</code> <b>value:</b> <em>QMC5883L_ODR_200</em> <br  />
 Description: Continuous conversion data rate</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="functions__mag_qmc5883l"></a>
Module functions</h1>
<h2><a class="anchor" id="init_functions"></a>
Init Functions</h2>
<p>These initialization functions are called once on startup.</p>
<ul>
<li><a class="el" href="mag__qmc5883l_8c.html#add8408e3650fa4ee6ce7d6d86188e244">mag_qmc5883l_module_init()</a></li>
</ul>
<h2><a class="anchor" id="event_functions"></a>
Event Functions</h2>
<p>These event functions are called in each cycle of the module event loop.</p>
<ul>
<li><a class="el" href="mag__qmc5883l_8c.html#afcb14eb0425acd1a1884a0fc8f43b981">mag_qmc5883l_module_event()</a></li>
</ul>
<h2><a class="anchor" id="periodic_functions"></a>
Periodic Functions</h2>
<p>These functions are called periodically at the specified frequency from the module periodic loop.</p>
<ul>
<li><a class="el" href="mag__qmc5883l_8c.html#a18aac3e370220c20ef23ed52efbe7e4a">mag_qmc5883l_module_periodic()</a><ul>
<li>Frequency in Hz: <em>MAG_QMC5883L_PERIODIC_FREQUENCY</em> </li>
<li>Autorun: <em>LOCK</em> <br  />
 Periodic function automatically starts after init and can't be stopped.</li>
</ul>
</li>
<li><a class="el" href="mag__qmc5883l_8c.html#a99c1fa81cceb58e6385111d0dabbe22b">mag_qmc5883l_report()</a><ul>
<li>Frequency in Hz: <em>10</em> </li>
<li>Autorun: <em>FALSE</em> <br  />
 Periodic function is started by user command.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="files"></a>
Files</h1>
<h2><a class="anchor" id="headers"></a>
Header Files</h2>
<p>The following headers are automatically included in modules.h</p>
<ul>
<li><a class="el" href="mag__qmc5883l_8h.html">mag_qmc5883l.h</a></li>
</ul>
<h2><a class="anchor" id="sources"></a>
Source Files</h2>
<ul>
<li><a class="el" href="mag__qmc5883l_8c.html">modules/sensors/mag_qmc5883l.c</a></li>
<li><a class="el" href="qmc5883l_8c.html">peripherals/qmc5883l.c</a></li>
</ul>
<h2><a class="anchor" id="module_xml__mag_qmc5883l"></a>
Raw mag_qmc5883l.xml file:</h2>
<div class="fragment"><div class="line">&lt;!<span class="keyword">DOCTYPE</span> <span class="keyword">module</span> <span class="keyword">SYSTEM</span> <span class="stringliteral">&quot;module.dtd&quot;</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mag_qmc5883l&quot;</span> <span class="keyword">dir</span>=<span class="stringliteral">&quot;sensors&quot;</span> <span class="keyword">task</span>=<span class="stringliteral">&quot;sensors&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">doc</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">description</span>&gt;</div>
<div class="line">      <span class="keyword">Module</span> <span class="keyword">to</span> <span class="keyword">be</span> <span class="keyword">able</span> <span class="keyword">to</span> <span class="keyword">use</span> <span class="keyword">an</span> <span class="keyword">QMC5883L</span> <span class="keyword">magnetometer.</span></div>
<div class="line"> </div>
<div class="line">      <span class="keyword">Intorduction:</span> <span class="keyword">Honeywell</span> <span class="keyword">discontinued</span> <span class="keyword">the</span> <span class="keyword">HMC5983</span>/<span class="keyword">HMC5883L</span> <span class="keyword">in</span> 2016 <span class="keyword">and</span> <span class="keyword">licensed</span> <span class="keyword">the</span> <span class="keyword">technology</span> <span class="keyword">to</span> <span class="keyword">QST</span> <span class="keyword">Corporation</span>, <span class="keyword">who</span> <span class="keyword">now</span> <span class="keyword">manufacture</span> <span class="keyword">the</span> <span class="keyword">replacement</span> <span class="keyword">QMC5883L.</span></div>
<div class="line">      <span class="keyword">However</span>, <span class="keyword">while</span> <span class="keyword">the</span> <span class="keyword">QMC5883L</span> <span class="keyword">is</span> <span class="keyword">pin</span> <span class="keyword">compatible</span> <span class="keyword">with</span> <span class="keyword">HMC</span>, <span class="keyword">it</span><span class="stringliteral">&#39;s registers are not the same as the Honeywell device. It&#39;</span><span class="keyword">s</span> <span class="keyword">essentially</span> <span class="keyword">a</span> <span class="keyword">different</span> <span class="keyword">chip.</span></div>
<div class="line"> </div>
<div class="line">      <span class="keyword">QST</span> <span class="keyword">Corporation</span> <span class="keyword">have</span> <span class="keyword">produced</span> <span class="keyword">two</span> <span class="keyword">versions</span> <span class="keyword">of</span> <span class="keyword">the</span> <span class="keyword">QMC5883L:</span></div>
<div class="line">      <span class="keyword">A</span> <span class="keyword">completely</span> <span class="keyword">undocumented</span> <span class="stringliteral">&#39;A&#39;</span> <span class="keyword">version</span> <span class="keyword">with</span> <span class="stringliteral">&quot;DA 5883&quot;</span> <span class="keyword">on</span> <span class="keyword">the</span> <span class="keyword">QFN</span> <span class="keyword">package</span> <span class="keyword">that</span> <span class="keyword">responds</span> <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">I2C</span> <span class="keyword">address</span> 0<span class="keyword">x1E.</span></div>
<div class="line">      <span class="keyword">It</span><span class="stringliteral">&#39;s identical to the HMC5983/HMC5883L, except that the status register doesn&#39;</span><span class="keyword">t</span> <span class="keyword">work.</span></div>
<div class="line">      <span class="keyword">The</span> <span class="keyword">DA</span> 5883 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">supported</span> <span class="keyword">by</span> <span class="keyword">this</span> <span class="keyword">driver</span> <span class="keyword">since</span> <span class="keyword">we</span> <span class="keyword">have</span> <span class="keyword">not</span> <span class="keyword">seen</span> <span class="keyword">any</span> <span class="keyword">samples</span> <span class="keyword">of</span> <span class="keyword">this</span> <span class="keyword">DA</span> <span class="keyword">version</span> <span class="keyword">in</span> <span class="keyword">the</span> <span class="keyword">wild</span></div>
<div class="line"> </div>
<div class="line">      <span class="keyword">A</span> <span class="keyword">documented</span> <span class="stringliteral">&#39;B&#39;</span> <span class="keyword">version</span> <span class="keyword">with</span> <span class="stringliteral">&quot;DB 5833&quot;</span> <span class="keyword">on</span> <span class="keyword">the</span> <span class="keyword">QFN</span> <span class="keyword">package</span> <span class="keyword">that</span> <span class="keyword">responds</span> <span class="keyword">to</span> <span class="keyword">I2C</span> <span class="keyword">address</span> 0<span class="keyword">x0D.</span> <span class="keyword">This</span> <span class="keyword">works</span> <span class="keyword">as</span> <span class="keyword">per</span> <span class="keyword">the</span> <span class="keyword">QMC5883L</span> <span class="keyword">datasheet.</span></div>
<div class="line">      </div>
<div class="line">      <span class="keyword">TIP:</span></div>
<div class="line">      <span class="keyword">An</span> <span class="keyword">arbitrary</span> <span class="keyword">rotation</span> <span class="keyword">between</span> <span class="keyword">the</span> <span class="keyword">sensor</span> <span class="keyword">frame</span> <span class="keyword">and</span> <span class="keyword">the</span> <span class="keyword">IMU</span> <span class="keyword">frame</span> <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">compensated</span> <span class="keyword">with</span> <span class="keyword">a</span> <span class="keyword">MAG_TO_IMU</span> <span class="keyword">rotation</span>, <span class="keyword">defined</span> <span class="keyword">by</span> <span class="keyword">three</span> <span class="keyword">euler</span> <span class="keyword">angles.</span> </div>
<div class="line">      <span class="keyword">The</span> <span class="keyword">three</span> <span class="keyword">angles</span> <span class="keyword">must</span> <span class="keyword">be</span> <span class="keyword">defined</span> <span class="keyword">to</span> <span class="keyword">enable</span> <span class="keyword">this</span> <span class="keyword">correction.</span> <span class="keyword">Otherwise</span> <span class="keyword">it</span> <span class="keyword">is</span> <span class="keyword">assumed</span> <span class="keyword">that</span> <span class="keyword">the</span> <span class="keyword">IMU</span> <span class="keyword">and</span> <span class="keyword">MAG</span> <span class="keyword">axis</span> <span class="keyword">are</span> <span class="keyword">aligned.</span></div>
<div class="line">    &lt;/<span class="keywordtype">description</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC5883L_I2C_DEV&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;i2c1&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;I2C device to use (e.g. i2c2)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MODULE_QMC5883L_SYNC_SEND&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;TRUE|FALSE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Send IMU_RAW message with each new measurement for debugging purposes (default: FALSE)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MODULE_QMC5883L_UPDATE_AHRS&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;TRUE|FALSE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Copy measurements to IMU and send as ABI message (default: FALSE)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QMC5883L_CHAN_X_SIGN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;+|-&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Set the polarity of x axis (default: +)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QMC5883L_CHAN_Y_SIGN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;+|-&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Set the polarity of y axis (default: +)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QMC5883L_CHAN_Z_SIGN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;+|-&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Set the polarity of z axis (default: +)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QMC5883L_CHAN_X&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0|1|2&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Channel id of x axis (default: 0)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QMC5883L_CHAN_Y&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0|1|2&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Channel id of y axis (default: 1)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QMC5883L_CHAN_Z&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0|1|2&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Channel id of z axis (default: 2)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">section</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC&quot;</span> <span class="keyword">prefix</span>=<span class="stringliteral">&quot;QMC5883L_&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_TO_IMU_PHI&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0.0&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Rotation between sensor frame and IMU frame (phi angle)&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_TO_IMU_THETA&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0.0&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Rotation between sensor frame and IMU frame (theta angle)&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_TO_IMU_PSI&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0.0&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Rotation between sensor frame and IMU frame (psi angle)&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DATA_RATE&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;QMC5883L_ODR_200&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Continuous conversion data rate&quot;</span>/&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">section</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">doc</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">dep</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">depends</span>&gt;<span class="keyword">i2c</span>,@<span class="keyword">imu</span>&lt;/<span class="keywordtype">depends</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">provides</span>&gt;<span class="keyword">mag</span>&lt;/<span class="keywordtype">provides</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">dep</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">header</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mag_qmc5883l.h&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">header</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">init</span> <span class="keyword">fun</span>=<span class="stringliteral">&quot;mag_qmc5883l_module_init()&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">periodic</span> <span class="keyword">fun</span>=<span class="stringliteral">&quot;mag_qmc5883l_module_periodic()&quot;</span> <span class="keyword">freq</span>=<span class="stringliteral">&quot;MAG_QMC5883L_PERIODIC_FREQUENCY&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">periodic</span> <span class="keyword">fun</span>=<span class="stringliteral">&quot;mag_qmc5883l_report()&quot;</span> <span class="keyword">freq</span>=<span class="stringliteral">&quot;10&quot;</span> <span class="keyword">autorun</span>=<span class="stringliteral">&quot;FALSE&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">event</span> <span class="keyword">fun</span>=<span class="stringliteral">&quot;mag_qmc5883l_module_event()&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">makefile</span> <span class="keyword">target</span>=<span class="stringliteral">&quot;ap&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;mag_qmc5883l.c&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;qmc5883l.c&quot;</span> <span class="keyword">dir</span>=<span class="stringliteral">&quot;peripherals&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">raw</span>&gt;</div>
<div class="line">      <span class="keyword">ifeq</span> ($(<span class="keyword">MAG_QMC5883L_I2C_DEV</span>),)</div>
<div class="line">        $(<span class="keyword">error</span> <span class="keyword">mag_qmc5883l</span> <span class="keyword">module</span> <span class="keyword">error:</span> <span class="keyword">please</span> <span class="keyword">configure</span> <span class="keyword">MAG_QMC5883L_I2C_DEV</span>)</div>
<div class="line">      <span class="keyword">endif</span></div>
<div class="line">    &lt;/<span class="keywordtype">raw</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC5883L_PERIODIC_FREQUENCY&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;50&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC5883L_I2C_DEV&quot;</span> <span class="keyword">case</span>=<span class="stringliteral">&quot;upper|lower&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC5883L_PERIODIC_FREQUENCY&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;$(MAG_QMC5883L_PERIODIC_FREQUENCY)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_$(MAG_QMC5883L_I2C_DEV_UPPER)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC5883L_I2C_DEV&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;$(MAG_QMC5883L_I2C_DEV_LOWER)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">test</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MAG_QMC5883L_I2C_DEV&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;i2c1&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_I2C1&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DOWNLINK_TRANSPORT&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;pprz_tp&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DOWNLINK_DEVICE&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;uart1&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_UART1&quot;</span>/&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">test</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">makefile</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="onboard_modules.html">Onboard Modules</a></li>
    <li class="footer">Generated on Thu Aug 28 2025 13:19:44 for Paparazzi UAS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
